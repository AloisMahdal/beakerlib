#if $getVar('rhts_server','') != ''

#set $yum = $getVar("yum","")
#if $yum == ""
    #if $os_version == "rhel3"
        #set $yum = "yum-2.2.2-1.rhts.EL3.noarch.rpm"
    #end if
    #if $os_version == "rhel4"
        #set $yum = "yum-2.2.2-1.rhts.EL4.noarch.rpm"
    #end if
#end if

#if $yum != ""
# Install Yum
pushd /root
/usr/bin/wget -N http://@@server@@/rpms/$yum
/bin/rpm -Uvh $yum
popd
#end if

# Add RHTS Test Repo
cat << EOF > /etc/yum.repos.d/rhts-tests.repo
[rhts]
name=rhts
baseurl=http://$rhts_server/rpms/rhts/noarch/noarch
enabled=1
gpgcheck=0

[rhts-tests-development]
name=rhts tests development
baseurl=http://$rhts_server/rpms/development/noarch/noarch
enabled=0
gpgcheck=0

[rhts-tests-production]
name=rhts tests production
baseurl=http://$rhts_server/rpms/production/noarch/noarch
enabled=0
gpgcheck=0
EOF

# Install RHTS RPMS
yum -y install rhts-test-env-lab rhts-legacy
yum -y install yum-utils

# Tell the system what recipe id it should be working on
mkdir -p /var/cache/rhts
echo $rhts_server:$recipeid > /var/cache/rhts/recipe.txt
#end if
